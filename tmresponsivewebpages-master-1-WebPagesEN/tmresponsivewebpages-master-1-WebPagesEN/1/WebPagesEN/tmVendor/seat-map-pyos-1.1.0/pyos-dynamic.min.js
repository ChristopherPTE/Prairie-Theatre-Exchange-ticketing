(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).PYOSDynamic={})})(this,(function(t){"use strict";var e=function(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t},a="http://www.w3.org/2000/svg",s="http://www.w3.org/1999/xlink",i="xlink:";function r(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=document.createElementNS(a,t);return _(s,e),s}function n(t,e){return t.getAttribute(e)}function o(t,e,a){0===e.indexOf(i)?t.setAttributeNS(s,e.substring(i.length),a):t.setAttribute(e,a)}function _(t,e){for(var a=0,s=Object.keys(e);a<s.length;a++){var i=s[a];o(t,i,e[i])}}function l(t){return-1===t.indexOf("xmlns")&&console.error("Creating svg from text that was missing the xmlns attribute: "+t),function(t){try{return(new window.DOMParser).parseFromString(t,"image/svg+xml")}catch(a){var e=document.createElement("div");return e.innerHTML=t,e}}(t).querySelector("svg")}function c(t,e){t.textContent=e}function h(t,e){var a=e.length;if(void 0!==a)for(var s=0;s<a;s++)h(t,e[s]);else t.appendChild(e)}function u(t,e){var a=e.length;if(void 0!==a)for(var s=0;s<a;s++)u(t,e[s]);else t.removeChild(e)}function m(t,e){for(var a,s=[],i=t.childNodes,r=0;a=i[r++];)1===a.nodeType&&s.push(a);h(e,s)}var v=[{label:"mm",matcher:/(.*)(mm)$/,inPixels:function(t){return 3.77952755905511*+t[1]}},{label:"px",matcher:/^([0-9]*)(\.[0-9]+)?$/,inPixels:function(t){return+t[0]}}];function d(t){for(var e,a=0;a<v.length;a++){var s=v[a];if(e=t.match(s.matcher))return s.inPixels(e)}return null}var p="data-seat-id",g="seat-shape-",f="theatre_manager_map",b="theatre_manager_background",z="map-background",y="map-background-link",w="theatre_manager_seats",x="theatre_manager_seat_",S="style-base",k="style-seat-colours",A="style-default-seat-colours",E="theatre_manager_seat_map",M="theatre_manager_seat",q="theatre_manager_seat_graphic",R="theatre_manager_seat_label",L="theatre_manager_seat_tooltip",O="selected",P="unavailable",j="reserved",T=new RegExp("{section}","g"),F=new RegExp("{row}","g"),B=new RegExp("{seat}","g"),C=new RegExp("{note}","g"),D=new RegExp("{door}","g"),W=new RegExp("{logical}","g"),H=["<br />","<br/>","<br>","\\s"],N=new RegExp("^("+H.join("|")+")+","i"),$=new RegExp("("+H.join("|")+")+$","i");function Y(t){return t.split(/[ ,]/).map((function(t){return+t}))}var V={rectangle:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="0" y="0" width="100" height="100"/></svg>',ellipse:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="50"/></svg>'};function X(){for(var t,e,a,s,i,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_=r("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",Version:"1.2",class:E,preserveAspectRatio:"xMidYMid"}),u=r("defs"),v={},d=0,p=Object.keys(V);d<p.length;d++){var z=p[d];v[z]=V[z]}for(var y=0,x=Object.keys(o);y<x.length;y++){var M=x[y];v[M]=o[M]}for(var q=0,R=Object.keys(v);q<R.length;q++){var L=R[q];a=(e=Y(n(t=l(v[L]),"viewBox")))[2],s=e[3],m(t,i=r("symbol",{id:g+L,width:1,height:1,viewBox:a/2+" "+s/2+" "+a+" "+s,preserveAspectRatio:"none",overflow:"visible"})),h(u,i)}h(_,u);var T=r("g",{id:f,transform:"translate(0,0), scale(1)"});h(_,T),h(T,r("g",{id:b}));var F,B,C=r("g",{id:w});return h(T,C),h(C,r("title")),h(_,(F=r("style",{id:S}),B="\n    .theatre_manager_seat {\n      cursor: pointer;\n    }\n    .theatre_manager_seat.".concat(j,",\n    .theatre_manager_seat.").concat(P," {\n      cursor: default;\n    }\n    .theatre_manager_seat .theatre_manager_seat_graphic {\n      fill: lightgrey;\n    }\n    theatre_manager_seat .theatre_manager_seat_label {\n      fill: lightgrey;\n    }\n    .theatre_manager_seat:hover .theatre_manager_seat_graphic {\n      fill: darkgrey;\n    }\n  "),c(F,B),F)),h(_,function(){var t=r("style",{id:k});return c(t,""),t}()),h(_,function(){var t=r("style",{id:A}),e="\n    .theatre_manager_seat.".concat(P,":hover .theatre_manager_seat_graphic,\n    .theatre_manager_seat.").concat(P," .theatre_manager_seat_graphic {\n      fill: white;\n    }\n    .theatre_manager_seat.").concat(P," .theatre_manager_seat_label {\n      fill: black;\n    }\n    .theatre_manager_seat.").concat(j,":hover .theatre_manager_seat_graphic,\n    .theatre_manager_seat.").concat(j," .theatre_manager_seat_graphic {\n      fill: red;\n    }\n    .theatre_manager_seat.").concat(j," .theatre_manager_seat_label {\n      fill: none;\n    }\n    .theatre_manager_seat.").concat(O,":hover .theatre_manager_seat_graphic,\n    .theatre_manager_seat.").concat(O," .theatre_manager_seat_graphic {\n      fill: purple;\n    }\n    .theatre_manager_seat.").concat(O," .theatre_manager_seat_label {\n      fill: purple;\n    }\n  ");return c(t,e),t}()),_}function G(t,e,a){var s=a;c(t,s=(s=(s=(s=(s=(s=(s=(s=s.replace(T,e.section||"")).replace(F,e.row||"")).replace(B,e.seat||"")).replace(C,e.note||"")).replace(D,e.door||"")).replace(W,e.logical_seat||"")).replace(N,"")).replace($,""))}function I(t,e){var a,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=t.querySelector("#"+w),n=!!i.querySelector("."+M+" title");if(s=function(t){return t=(t=(t=t.replace(new RegExp("\r\n","g"),"\r")).replace(new RegExp("\r","g"),"<br />")).replace(new RegExp("\n","g"),"<br />")}(s),n)for(var o=0;o<e.length;o++){var _=e[o];G(a=i.querySelector("#"+x+_.logical_seat+" title"),_,s)}else for(var l=0;l<e.length;l++){var c=e[l];h(i.querySelector("#"+x+c.logical_seat),a=r("title",{class:L})),G(a,c,s)}}function U(t,e,a,s,i,r,_){var l,h={};if(a){l=function(t,e,a){for(var s={},i=0;i<t.length;i++){var r=t[i];s[r[e]]=a(r)}return s}(a,"logical_seat",(function(t){return void 0!==e&&e===t.letter?{seatClass:P,letterMask:i}:{seatClass:P,letterMask:s}}));for(var u=0,m=Object.keys(l);u<m.length;u++){var v=m[u];h[v]=l[v]}}if(r){l=function(t,e,a){for(var s={},i=0;i<t.length;i++){s[t[i][e]]=a}return s}(r,"logical_seat",{seatClass:j,letterMask:_});for(var d=0,g=Object.keys(l);d<g.length;d++){var f=g[d];h[f]=l[f]}}(function(t,e){for(var a,s=t.querySelector("#"+w),i=[].slice.call(s.querySelectorAll("."+M)),r=0;r<i.length;r++){var _=i[r];a=e[n(_,p)],o(_,"class",M+(a?" "+a.seatClass:"")),c(_.querySelector("."+R),a?a.letterMask:"")}})(t,h)}function J(t){var a,s,i,n=t.seatPosition,_=n.logical_seat,l=r("g",(a={transform:"translate("+n.x+","+n.y+")",id:x+_},e(a,p,_),e(a,"class",M),a)),c=r("use",{width:n.width,height:n.height,class:q,transform:"rotate("+(void 0!==n.rotation?n.rotation:0)+")"});s=c,i=n.shape,o(s,"xlink:href","#"+g+i);var u=r("text",{dy:"0.35em","text-anchor":"middle","font-size":6,class:R});return h(l,c),h(l,u),l}var K=[{label:"mm",matcher:/(.*)(mm)$/,inPixels:function(t){return 3.77952755905511*+t[1]}},{label:"px",matcher:/^([0-9]*)(\.[0-9]+)?$/,inPixels:function(t){return+t[0]}}];function Q(t){var e,a=null;return K.forEach((function(s){a||(e=t.match(s.matcher))&&(a=s.inPixels(e))})),a}function Z(t){for(var e={},a=t.match(/(\w+\((\-?\d+\.?\d* ?\d*,?)+\))+/g),s=0;s<a.length;s++){var i=a[s].match(/[\w\.\-]+/g);e[i.shift()]=i}return e.translate&&1===e.translate.length&&e.translate.push(0),e}function tt(t){this.selector=t}tt.prototype={init:function(t){this.dragged=!1,this.drag_start_point=null,this.pan_zoom_start=null,t=t||{},this.unavailable_text=t.unavailable_text||null,this.seat_class=t.seat_class||"theatre_manager_seat",this.seat_graphic_selector=t.seat_graphic_selector||".theatre_manager_seat_graphic",this.unavailable_class=t.unavailable_class||"unavailable",this.selected_class=t.selected_class||"selected",this.reserved_class=t.reserved_class||"reserved",this.seat_id_attribute=t.seat_id_attribute||"data-seat-id",this.reserved_zoom_seat_count=t.reserved_zoom_seat_count||15,this.pan_step_distance=t.pan_step_distance||20,this.zoom_multiple=t.zoom_multiple||.1,this.seat_selector=t.seat_selector||"g."+this.seat_class,this.swap_input_selector=t.swap_input_selector||"#F_HTML_NEXT_BEST_SEAT_SWAP",this.pan_zoom_selector=t.pan_zoom_selector||"#theatre_manager_map",this.click_callback=t.click_callback||null,this.reserve_callback=t.reserve_callback||null;var e=document.querySelector(this.selector),a=X();e.innerHTML="",e.appendChild(a),this.root=e.querySelector("svg"),this.body=document.querySelector("body")},_initSvg:function(){this.width=Q(this.root.getAttribute("width")),this.height=Q(this.root.getAttribute("height"));var t=this.root.getAttribute("viewBox").split(" ");this.viewWidth=this.width,this.viewHeight=this.height,4===t.length&&(this.viewWidth=parseInt(t[2]),this.viewHeight=parseInt(t[3]));var e=this;e.pan_zoom_layer=e.root.querySelector(e.pan_zoom_selector);var a=e.root.getScreenCTM?e.root.getScreenCTM().inverse():null,s=e.root.createSVGPoint?e.root.createSVGPoint():null;function i(t,e){return a&&s&&(s.x=t,s.y=e,t=(s=s.matrixTransform(a)).x,e=s.y),{x:t,y:e}}function r(t){t.preventDefault();var a=i(t.screenX,t.screenY),s=a.x-e.drag_start_point.x,r=a.y-e.drag_start_point.y;0===s&&0===r||(e.dragged=!0,e.body.setAttribute("style","cursor:move;"),e.root.setAttribute("style","cursor:move;"),e.pan_zoom(e.pan_zoom_start.x+s,e.pan_zoom_start.y+r,e._pan_zoom.z))}function n(t){e.drag_start_point&&(e.body.setAttribute("style","cursor:auto;"),e.root.setAttribute("style","cursor:auto;"),document.removeEventListener("mousemove",r),e.root.removeEventListener("mousemove",r),e.dragged=!1,e.drag_start_point=null,e.pan_zoom_start=null)}e.root.addEventListener("mousedown",(function(t){1===t.which&&(t.preventDefault(),e.dragged=!1,e.pan_zoom_start={x:e._pan_zoom.x,y:e._pan_zoom.y},e.drag_start_point=i(t.screenX,t.screenY),document.addEventListener("mousemove",r),e.root.addEventListener("mousemove",r))})),document.addEventListener("mouseup",n),e.root.addEventListener("mouseup",n);var o=Z(e.pan_zoom_layer.getAttribute("transform"));e._initial_pan_zoom={x:parseFloat(o.translate[0]),y:parseFloat(o.translate[1]),z:parseFloat(o.scale[0])},e._pan_zoom=e._initial_pan_zoom},_initSvgSeats:function(){var t=this;t._seat_map={},t.seats=[].slice.call(t.root.querySelectorAll(t.seat_selector)),t.seats.forEach((function(e){t._seat_map[e.getAttribute(t.seat_id_attribute)]=e,e.addEventListener("mouseup",(function(){!1===t.dragged&&t._click_seat(e)}))}))},setOmnisWidth:function(t){this._omnisWidth=t,this._setBackgroundSvg()},setSocialDistanceLetter:function(t){this._socialDistanceLetter=t,this._setSeatAvailabilityAndReserved()},setBackground:function(t){this._svgText=t,this._setBackgroundSvg()},_setBackgroundSvg:function(){this._svgText&&this._omnisWidth&&(function(t,e,a,s){var i=t.querySelector("defs"),o=l(e),c=n(o,"width"),m=n(o,"height"),v=d(c),p=d(m),g=Y(n(o,"viewBox")),f=g[2],w=g[3],x=void 0!==a,S=x?a:v,k=x?function(t,e,a){return e/t*a}(f,w,a):p;_(t,{width:s?S:c,height:s?k:m,viewBox:"0 0 "+Math.floor(S)+" "+Math.floor(k)});var A=i.querySelector("#"+z);A&&u(i,A),_(o,{width:"100%",height:"100%",id:z}),h(i,o);var E=t.querySelector("#"+b),M=E.querySelector("#"+y);M&&u(E,M),h(E,r("use",{id:y,"xlink:href":"#"+z}))}(this.root,this._svgText,this._omnisWidth),this._initSvg())},setSeatPositions:function(t){this._positions=t,function(t,e){for(var a=t.querySelector("#"+w),s=0;s<e.length;s++){h(a,J({seatPosition:e[s],showSeatLabel:!1}))}}(this.root,t),this._initSvgSeats(),this._tooltipFormat&&this._names&&this.setSeatNames(this._names,this._tooltipFormat),(this._availability||this._reserved)&&this._setSeatAvailabilityAndReserved()},setSeatNames:function(t){this._names=t,this._tooltipFormat&&this._positions&&I(this.root,t,this._tooltipFormat)},setSeatTooltipFormat:function(t){this._tooltipFormat=t,this._names&&this._positions&&I(this.root,this._names,t)},setSeatAvailability:function(t,e,a){this._availability=t,this._availabilityUnavailableMask=e,this._availabilitySocialDistanceMask=a,this._setSeatAvailabilityAndReserved()},setSeatReserved:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this._reserved=t,this._reservedLetterMask=e,this._setSeatAvailabilityAndReserved()},_setSeatAvailabilityAndReserved:function(){this._positions&&U(this.root,this._socialDistanceLetter,this._availability,this._availabilityUnavailableMask,this._availabilitySocialDistanceMask,this._reserved,this._reservedLetterMask)},zoom_reserved_seats:function(){if(this._positions&&this._reserved){var t=this,e=0,a=0,s=void 0,i=void 0,r=void 0,n=void 0;t.seats.forEach((function(o){var _=t._get_dimensions(o);if(_.width&&(e+=_.width),_.height&&(a+=_.height),void 0!==_.x&&void 0!==_.y&&void 0!==_.width&&void 0!==_.height&&t._has_class(o,t.reserved_class)){var l=_.x,c=l+_.width,h=_.y,u=h+_.height;(void 0===s||s>l)&&(s=l),(void 0===i||i<c)&&(i=c),(void 0===r||r>h)&&(r=h),(void 0===n||n<u)&&(n=u)}}));var o=e/t.seats.length,_=a/t.seats.length;if(t.reserved_zoom_seat_count>=0&&o>0&&_>0&&void 0!==s&&void 0!==i&&void 0!==r&&void 0!==n){var l=t.reserved_zoom_seat_count*o,c=t.reserved_zoom_seat_count*_,h=s-l,u=r-c,m=i+l-h,v=n+c-u,d=t.viewWidth/t._initial_pan_zoom.z,p=t.viewHeight/t._initial_pan_zoom.z,g=m<d?d/m:1,f=v<p?p/v:1;if(g>1&&f>1){var b=Math.min(g,f);if((b=Math.round(b/t.zoom_multiple)*t.zoom_multiple)>1){var z=b*t._initial_pan_zoom.z,y=t._initial_pan_zoom.x-z*(h+m/2)+d/2,w=t._initial_pan_zoom.y-z*(u+v/2)+p/2;t.pan_zoom(y,w,z)}}}}},_trim_spaces_and_commas:function(t){return t.replace(/^[,\s]+|[,\s]+$/g,"")},_has_class:function(t,e){var a=t.getAttribute("class");return null!=a&&""!==a&&a.split(" ").indexOf(e)>=0},_add_class:function(t,e){this._has_class(t,e)||t.setAttribute("class",t.getAttribute("class")+" "+e)},_remove_class:function(t,e){var a=t.getAttribute("class");if(null!=a&&""!==a&&(null!=e&&""!==e&&(e=this._trim_spaces_and_commas(e)),null!=e&&""!==e)){for(var s=a.split(" "),i=s.indexOf(e),r=0;r<s.length;r++){var n=s[r];r!=i&&null!=n&&""!==n||delete s[r]}var o=this._trim_spaces_and_commas(s.join(" "));t.setAttribute("class",o)}},_get_dimensions:function(t){var e=Z(t.getAttribute("transform")),a=t.querySelector(this.seat_graphic_selector);return{x:+e.translate[0],y:+e.translate[1],width:parseFloat(a.getAttribute("width")),height:parseFloat(a.getAttribute("height"))}},_update_swap_input:function(t,e){var a=this;null!=a.swap_input_selector&&[].slice.call(document.querySelectorAll(a.swap_input_selector)).forEach((function(s){for(var i=a._trim_spaces_and_commas(s.value).split(","),r={},n=null,o=0;o<i.length;o++)null!=(n=i[o])&&""!==n&&(r[n]=!0);!0===e?r[t]=!0:delete r[t];var _=Object.keys(r).join(",");s.value=_}))},_click_seat:function(t){if(!this._has_class(t,this.unavailable_class)){var e=t.getAttribute(this.seat_id_attribute),a=this._has_class(t,this.selected_class),s=!0;if(null!=this.click_callback)!1===this.click_callback(this,e,a)&&(s=!1);1==s?a?(this._update_swap_input(e,!1),this._remove_class(t,this.selected_class)):(this._update_swap_input(e,!0),this._add_class(t,this.selected_class)):(this._update_swap_input(e,!1),this._add_class(t,this.unavailable_class))}},reserve_seats:function(t){var e=this,a=[];this.seats.forEach((function(t){e._has_class(t,e.selected_class)&&a.push(t.getAttribute(e.seat_id_attribute))}));var s={};for(var i in null!=e.reserve_callback?(function(t){throw new Error('"'+t+'" is read-only')}("results"),s=e.reserve_callback(e,a)):a.forEach((function(t){s[t]=!0})),s)if(s.hasOwnProperty(i)){var r=this._seat_map[i];s[i]?(e._remove_class(r,e.selected_class),e._add_class(r,e.reserved_class)):(e._remove_class(r,e.reserved_class),e._remove_class(r,e.selected_class))}null!=t&&t(s)},clear_seats:function(){var t=this;t.seats.forEach((function(e){if(t._has_class(e,t.selected_class)){var a=e.getAttribute(t.seat_id_attribute),s=!0;if(null!=t.click_callback)!1===t.click_callback(t,a,!0)&&(s=!1);t._update_swap_input(a,!1),1==s?t._remove_class(e,t.selected_class):(t._remove_class(e,t.selected_class),t._add_class(e,t.unavailable_class))}}))},pan_zoom:function(t,e,a){this._pan_zoom={x:t,y:e,z:a},this.pan_zoom_layer.setAttribute("transform","translate("+t+" "+e+") scale("+a+")")},reset_pan_zoom:function(){this.pan_zoom(this._initial_pan_zoom.x,this._initial_pan_zoom.y,this._initial_pan_zoom.z)},pan_left:function(t){t=t||this.pan_step_distance,this.pan_zoom(this._pan_zoom.x+t,this._pan_zoom.y,this._pan_zoom.z)},pan_right:function(t){t=t||this.pan_step_distance,this.pan_zoom(this._pan_zoom.x-t,this._pan_zoom.y,this._pan_zoom.z)},pan_up:function(t){t=t||this.pan_step_distance,this.pan_zoom(this._pan_zoom.x,this._pan_zoom.y+t,this._pan_zoom.z)},pan_down:function(t){t=t||this.pan_step_distance,this.pan_zoom(this._pan_zoom.x,this._pan_zoom.y-t,this._pan_zoom.z)},zoom_in:function(t){t=t||this.zoom_multiple;var e=(this.width/2-this._pan_zoom.x)/this._pan_zoom.z,a=(this.height/2-this._pan_zoom.y)/this._pan_zoom.z;this.pan_zoom(this.width/2-e*(this._pan_zoom.z+t),this.height/2-a*(this._pan_zoom.z+t),this._pan_zoom.z+t)},zoom_out:function(t){t=t||this.zoom_multiple;var e=(this.width/2-this._pan_zoom.x)/this._pan_zoom.z,a=(this.height/2-this._pan_zoom.y)/this._pan_zoom.z;this.pan_zoom(this.width/2-e*(this._pan_zoom.z-t),this.height/2-a*(this._pan_zoom.z-t),this._pan_zoom.z-t)}},t.SeatSelection=tt,Object.defineProperty(t,"__esModule",{value:!0})}));
